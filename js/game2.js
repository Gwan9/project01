var ctx,canvas,bg1=new Image;bg1.src="../images/space.jpg";var bg2=new Image;bg2.src="../images/space.jpg";var gunship1=new Image;gunship1.src="../images/gunship4.png";var gunship2=new Image;gunship2.src="../images/gunship5.png";var gunship3=new Image;gunship3.src="../images/gunship6.png";var gunship4=new Image;gunship4.src="../images/gunship7.png";var enemyShip1=new Image;enemyShip1.src="../images/gunship0.png";var enemyShip2=new Image;enemyShip2.src="../images/gunship1.png";var enemyShip3=new Image;enemyShip3.src="../images/gunship2.png";var enemyShip4=new Image;enemyShip4.src="../images/gunship3.png";var enemyShip11=new Image;enemyShip11.src="../images/gunship11.png";var enemyShip12=new Image;enemyShip12.src="../images/gunship12.png";var enemyShip13=new Image;enemyShip13.src="../images/gunship13.png";var enemyShip14=new Image;enemyShip14.src="../images/gunship14.png";var enemyShip21=new Image;enemyShip21.src="../images/gunship21.png";var enemyShip22=new Image;enemyShip22.src="../images/gunship22.png";var enemyShip23=new Image;enemyShip23.src="../images/gunship23.png";var enemyShip24=new Image;enemyShip24.src="../images/gunship24.png";var bgMusic=new Audio;bgMusic.src="../sounds/Burning_Body.mp3";var missileMusic=new Audio;missileMusic.src="../sounds/fire2.wav";var missile1=new Image;missile1.src="../images/missile1.png";var spaceCrashSound=new Audio;spaceCrashSound.src="../sounds/scream.wav";var counter=0,bgY=0,bg2Y=-800,missileX=0,missileY=0,shipX=0,shipY=0,missileArray=[],e1X=0,e1Y=50,e2X=0,e2Y=50,e3X=0,e3Y=50,enemyArray=[],enemyX=0,score=0,isGameOver=!1;function resetGame(e){console.log("reset 함수 호출중"),console.dir(e),console.log(e.keyCode),isGameOver&&88==e.keyCode&&(isGameOver=!1,canvas.onmousemove=moveship,canvas.onmousedown=fireMissile,shipX=250,shipY=500,score=0)}function drawScreen(){checkCollision(),counter%20==0&&makeEnemy(),counter++,bgY+=30,bg2Y+=30,e1Y+=30,e2Y+=30,e3Y+=30;for(var e=0;e<enemyArray.length;e++){var n=enemyArray[e];n.y+=10}e1Y>=800&&(e1Y=0),e2Y>=800&&(e2Y=0),e3Y>=800&&(e3Y=0);for(var e=0;e<missileArray.length;e++){var s=missileArray[e];s.y-=10}bgY>=800&&(bgY=0,(bg2Y=-800)>=0&&(bgY=0,bg2Y=-800)),ctx.drawImage(bg1,0,bgY,600,800),ctx.drawImage(bg2,0,bg2Y,600,800),counter%4==1?ctx.drawImage(gunship1,shipX-25,shipY-25,50,50):counter%4==2?ctx.drawImage(gunship2,shipX-25,shipY-25,50,50):counter%4==3?ctx.drawImage(gunship3,shipX-25,shipY-25,50,50):ctx.drawImage(gunship4,shipX-25,shipY-25,50,50);for(var e=0;e<enemyArray.length;e++){var n=enemyArray[e];1==n.type?counter%4==1?ctx.drawImage(enemyShip1,n.x-25,n.y-25,50,50):counter%4==2?ctx.drawImage(enemyShip2,n.x-25,n.y-25,50,50):counter%4==3?ctx.drawImage(enemyShip3,n.x-25,n.y-25,50,50):ctx.drawImage(enemyShip4,n.x-25,n.y-25,50,50):2==n.type?counter%4==1?ctx.drawImage(enemyShip11,n.x-25,n.y-25,50,50):counter%4==2?ctx.drawImage(enemyShip12,n.x-25,n.y-25,50,50):counter%4==3?ctx.drawImage(enemyShip13,n.x-25,n.y-25,50,50):ctx.drawImage(enemyShip14,n.x-25,n.y-25,50,50):3==n.type&&(counter%4==1?ctx.drawImage(enemyShip21,n.x-50,n.y-50,100,100):counter%4==2?ctx.drawImage(enemyShip22,n.x-50,n.y-50,100,100):counter%4==3?ctx.drawImage(enemyShip23,n.x-50,n.y-50,100,100):ctx.drawImage(enemyShip24,n.x-50,n.y-50,100,100)),n.y>=1e3&&enemyArray.shift()}for(var e=0;e<missileArray.length;e++){var s=missileArray[e];ctx.drawImage(missile1,s.x,s.y,10,10),s.y<-60&&missileArray.shift()}ctx.fillStyle="red",ctx.font="25px 고딕",ctx.fillText("score : "+score,250,50),isGameOver&&(ctx.fillStyle="red",ctx.font="80px 고딕",ctx.fillText("GAME OVER",70,400),ctx.font="30px 고딕",ctx.fillText("Please Insert Coin",180,450))}function gameOver(){console.log("GAME OVER"),canvas.onmousedown="",canvas.onmousemove="",isGameOver=!0}function moveship(e){shipX=e.pageX,shipY=e.pageY}function fireMissile(e){var n={x:mX=e.pageX,y:mY=e.pageY};missileArray.push(n),missileMusic.currentTime=0,missileMusic.play(n)}function makeEnemy(){var e=Math.floor(3*Math.random())+1,n={x:enemyX=550*Math.random(),y:50,type:e,hp:100*e};enemyArray.push(n)}function pythagoras(e,n,s,i){return Math.sqrt((s-e)*(s-e)+(i-n)*(i-n))}function checkCollision(){for(var e=0;e<enemyArray.length;e++){var n=enemyArray[e];40>=pythagoras(n.x,n.y,shipX,shipY)&&gameOver()}}function checkCollision2(){for(var e=0;e<missileArray.length;e++)for(var n=missileArray[e],s=0;s<enemyArray.length;s++){var i=enemyArray[s];40>=pythagoras(i.x,i.y,n.x,n.y)&&(console.log("쾅!"),i.hp-=50,n.x=-400,i.y-=30,i.hp<=0&&(i.x=-100,n.x=-400,1==i.type?score+=100:2==i.type?score+=200:3==i.type&&(score+=300),spaceCrashSound.currentTime=0,spaceCrashSound.play()))}}function startMusic(){bgMusic.play(),console.log("배경음악 on")}function stopMusic(){bgMusic.pause(),bgMusic.currentTime=0,console.log("배경음악 off")}window.onload=function(){ctx=(canvas=document.getElementById("myCanvas")).getContext("2d"),window.setInterval(drawScreen,50),window.setInterval(checkCollision,5e3),window.setInterval(checkCollision2,100),canvas.onmousemove=moveship,canvas.onmousedown=fireMissile,document.body.onkeydown=resetGame};